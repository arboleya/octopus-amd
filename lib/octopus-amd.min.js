/*
 * Octopus Micro AMD Loader - v0.1.0
 *
*/var Chunk,OctopusAMD,Script,define,require,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Script=function(){function c(a,b,c,d,e,f){var g=this;this.id=a,this.url=b,this.done=c,this.error=d,this.is_non_amd=f,setTimeout(function(){return g.load()},e)}var a,b;return b={},a={},c.prototype.id=null,c.prototype.el=null,c.prototype.url=null,c.prototype.done=null,c.prototype.error=null,c.prototype.load=function(){var c,d,e=this;OctopusAMD.MAP[this.id]!=null?this.url=OctopusAMD.MAP[this.id]:this.url=this.id,/^http/m.test(this.url)||(d=new RegExp("(^"+OctopusAMD.BASE_URL.replace("/","\\/")+")"),d.test(this.url)||(this.url=""+OctopusAMD.BASE_URL+this.url)),this.url.indexOf(".js")<0&&(this.url+=".js");if(a[this.url]===!0)return this.done(this.id,this.url);if(b[this.url]!=null)return;return this.el=document.createElement("script"),this.el.type="text/javascript",this.el.charset="utf-8",this.el.async=!0,this.el.setAttribute("data-id",this.id),this.el.src=this.url,this.el.onerror=this.error,this.el.readyState?this.el.onreadystatechange=function(a){if(e.el.readyState==="loaded"||e.el.readyState==="complete")return e.el.onreadystatechange=null,e.internal_done(a)}:this.el.onload=function(a){return e.internal_done(a)},b[this.url]=!0,c=document.getElementsByTagName("head")[0],c.insertBefore(this.el,c.lastChild)},c.prototype.internal_done=function(b){return a[this.url]=!0,this.done(this.id,this.el.src,this.is_non_amd)},c}(),Chunk=function(){function a(b,c,d,e,f){this.type=b,this.id=c,this.deps=d,this.factory=e,this.non_amd=f!=null?f:!1,this.id!=null&&this.id[0]===":"&&(this.id=this.id.substr(1)),a.chunks_list.unshift(this)}return a.chunks={},a.chunks_list=[],a.prototype.type=null,a.prototype.id=null,a.prototype.deps=null,a.prototype.factory=null,a.prototype.non_amd=null,a.prototype.factored=null,a.notify_all=function(a){var b,c,d,e,f;e=this.chunks_list,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b.exec(a));return f},a.reorder=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;a==null&&(a=!1),n=this.chunks_list;for(c=j=0,l=n.length;j<l;c=++j){b=n[c];if(!b.deps.length)continue;o=b.deps;for(h=k=0,m=o.length;k<m;h=++k){e=o[h];if(e[0]===":")continue;g=this._get_index_by_id(e);if(g!=null&&g<c)continue;f=this.chunks_list[g];if(f!=null){if(f.deps.length&&(p=b.id,__indexOf.call(f.deps,p)>=0)){b.deps.splice(h,1),i="Circular dependency found between '"+b.id+"' and ",i+="'"+f.id+"'",console.error(i);continue}return d=this.chunks_list,d.splice(c,0,d.splice(g,1)[0]),this.reorder(!0)}}}},a._get_index_by_id=function(a){var b,c,d,e,f;f=this.chunks_list;for(c=d=0,e=f.length;d<e;c=++d){b=f[c];if(b.id===a)return c}return null},a.prototype.exec=function(b){var c,d,e,f,g,h,i;if(this.factored!=null)return this.factored;if(!this._is_subtree_loaded())return;if(this.factory==null)return;f=[],i=this.deps;for(g=0,h=i.length;g<h;g++){d=i[g];if(d[0]===":")continue;c=a.chunks[d],e=c.exec(b),e!=null&&f.push(e)}return this.factory instanceof Function?(this.type==="require"&&(this.execd=!0),this.factored=this.factory.apply(null,f)):typeof this.factory=="object"&&(this.factored=this.factory),this.factored},a.prototype._is_subtree_loaded=function(){var b,c,d,e,f;c=!0,f=this.deps;for(d=0,e=f.length;d<e;d++){b=f[d],b[0]===":"&&(b=b.substr(1));if(a.chunks[b]==null)return!1;b=a.chunks[b];if(b.factored===null&&b.non_amd===!1)return!1}return c},a}(),require=function(){return OctopusAMD.process("require",[].slice.call(arguments))},define=function(){return OctopusAMD.process("define",[].slice.call(arguments))},OctopusAMD=function(){function a(){}return a.last_chunk=null,a.BASE_URL=null,a.MAP={},a.config=function(a){return this.BASE_URL=a.base_url||"",this.MAP=a.paths||{}},a.process=function(b,c){var d,e,f,g,h,i,j,k,l,m,n;this.last_chunk!=null&&this.last_chunk.type==="require"&&this.define_chunk("root"),c=this._name_params(b,c),d=new Chunk(b,c.id,c.deps,c.factory),b==="define"&&d.id!=null?Chunk.chunks[d.id]=d:this.last_chunk=d,i=0,l=c.deps,n=[];for(j=0,k=l.length;j<k;j++){e=l[j],m=this.disassemble(e),f=m[0],g=m[1],h=m[2];if(Chunk.chunks[f]!=null)continue;n.push(new Script(f,g,function(b,c,d){return a.define_chunk(b,c,d),Chunk.reorder(),Chunk.notify_all(b)},function(a){return console.error(a)},i+=1,h))}return n},a.disassemble=function(a){var b,c,d;return c=!1,a[0]===":"&&(c=!0,a=a.substr(1)),this.MAP[a]!=null?d=this.MAP[a]:d=a,/^http/m.test(d)||(b=new RegExp("(^"+this.BASE_URL.replace("/","\\/")+")"),b.test(d)||(d=""+this.BASE_URL+d)),d.indexOf(".js")<0&&(d+=".js"),[a,d,c]},a.define_chunk=function(a,b,c){if(this.last_chunk===null&&c)return Chunk.chunks[a]=new Chunk("require",a,[],null,!0);if(this.last_chunk!=null)return this.last_chunk.id=this.last_chunk.id||a,this.last_chunk.id[0]===":"&&(this.last_chunk.id=this.last_chunk.id.substr(1)),Chunk.chunks[this.last_chunk.id]=this.last_chunk,this.last_chunk=null},a._name_params=function(a,b){var c;c={id:null,deps:null,factory:null};switch(a){case"require":c.deps=b[0],c.factory=b[1]||null;break;case"define":c.factory=b[b.length-1];if(b.length===3)c.id=b[0],c.deps=[].concat(b[1]);else if(b.length===2)c.deps=[].concat(b[0]);else if(b.length=1)c.deps=[]}return c},a}();